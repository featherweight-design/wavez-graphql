// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

//* Device
enum DeviceType {
  NANOLEAF
  LIFX
  HUE
}

enum DevicePropertyType {
  NanoleafProperties
  LifxProperties
  HueProperties
}

model Device {
  id         String             @id @default(uuid())
  name       String             @unique
  mac        String             @unique
  type       DeviceType
  user       User               @relation(fields: [userId], references: [id])
  userId     String             @unique
  properties DevicePropertyType
}

//* Nanoleaf
model NanoleafUser {
  id         String              @id @default(uuid())
  authTokens NanoleafAuthToken[]
  user       User                @relation(fields: [userId], references: [id])
  userId     String              @unique
}

model NanoleafAuthToken {
  id              String             @id @default(uuid())
  authToken       String             @unique
  nanoLeafPanel   NanoleafProperties @relation(fields: [nanoLeafPanelId], references: [id])
  nanoLeafPanelId String
  NanoleafUser    NanoleafUser?      @relation(fields: [nanoleafUserId], references: [id])
  nanoleafUserId  String?
}

model NanoleafProperties {
  id              String               @id @default(uuid())
  name            String
  serialNo        String               @unique
  firmwareVersion String
  model           String
  state           NanoleafState?
  effects         NanoleafEffects?
  panelLayout     NanoleafPanelLayout?
  rhythm          NanoleafRhythm?
  authToken       NanoleafAuthToken?
}

model NanoleafState {
  id                   String              @id @default(uuid())
  on                   NanoleafStateValue? @relation("on")
  brightness           NanoleafStateValue? @relation("brightness")
  hue                  NanoleafStateValue? @relation("hue")
  sat                  NanoleafStateValue? @relation("sat")
  ct                   NanoleafStateValue? @relation("ct")
  colorMode            String
  nanoLeafProperties   NanoleafProperties  @relation(fields: [nanoLeafPropertiesId], references: [id])
  nanoLeafPropertiesId String              @unique
}

model NanoleafStateValue {
  value                   Boolean
  max                     Int?
  min                     Int?
  nanoLeafStateId         String         @unique
  nanoLeafStateOn         NanoleafState? @relation("on", fields: [nanoLeafStateId], references: [id])
  nanoLeafStateBrightness NanoleafState? @relation("brightness", fields: [nanoLeafStateId], references: [id])
  nanoLeafStateHue        NanoleafState? @relation("hue", fields: [nanoLeafStateId], references: [id])
  nanoLeafStateSat        NanoleafState? @relation("sat", fields: [nanoLeafStateId], references: [id])
  nanoLeafStateCt         NanoleafState? @relation("ct", fields: [nanoLeafStateId], references: [id])
}

model NanoleafEffects {
  select               String
  effectsList          String[]
  nanoLeafProperties   NanoleafProperties @relation(fields: [nanoLeafPropertiesId], references: [id])
  nanoLeafPropertiesId String             @unique
}

model NanoleafPanelLayout {
  id                   String             @id @default(uuid())
  nanoLeafProperties   NanoleafProperties @relation(fields: [nanoLeafPropertiesId], references: [id])
  nanoLeafPropertiesId String             @unique
}

model NanoleafLayout {
  id                String                          @id @default(uuid())
  numPanels         Int
  sideLength        Int
  positionData      NanoleafPosition?
  globalOrientation NanoleafGlobalOrientationValue?
}

model NanoleafPosition {
  id               String          @id @default(uuid())
  panelId          Int?
  x                Int
  y                Int
  o                Int
  nanoLeafLayout   NanoleafLayout? @relation(fields: [nanoLeafLayoutId], references: [id])
  nanoLeafLayoutId String?         @unique
  nanoLeafRhythm   NanoleafRhythm? @relation(fields: [nanoLeafRhythmId], references: [id])
  nanoLeafRhythmId String?         @unique
}

model NanoleafGlobalOrientationValue {
  value            Boolean
  max              Int?
  min              Int?
  nanoLeafLayout   NanoleafLayout @relation(fields: [nanoLeafLayoutId], references: [id])
  nanoLeafLayoutId String         @unique
}

model NanoleafRhythm {
  id                   String             @id @default(uuid())
  rhythmConnected      Boolean
  rhytmActive          Boolean?
  rhythmId             Int?
  hardwareVersion      String?
  firmwareVersion      String?
  auxAvailable         Boolean?
  rhythmMode           Float?
  rhythmPos            NanoleafPosition?
  nanoLeafProperties   NanoleafProperties @relation(fields: [nanoLeafPropertiesId], references: [id])
  nanoLeafPropertiesId String             @unique
}

//* Lifx
model LifxProperties {
  id String @id @default(uuid())
}

//* Hue
model HueProperties {
  id String @id @default(uuid())
}

//* User
model User {
  id           String        @id @default(uuid())
  email        String        @unique
  name         String?
  nanoleafUser NanoleafUser?
  devices      Device[]
}
